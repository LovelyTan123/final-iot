You said:
#include <WiFi.h>
#include <DHT.h>
#include <HTTPClient.h>
#include <time.h>

// ====== SENSOR CONFIG ======
#define LIGHT_SENSOR_PIN 32
#define DHTPIN 25
#define PIR_SENSOR_PIN 33
#define DHTTYPE DHT22
DHT dht(DHTPIN, DHTTYPE);

// ====== WIFI CONFIG ======
const char* ssid = "vivo1906";
const char* password = "11111111";

// ====== FIREBASE CONFIG ======
const String firebaseHost = "https://iotfinal-73d37-default-rtdb.asia-southeast1.firebasedatabase.app";

// ====== SENSOR STATE VARIABLES ======
String lightState = "UNKNOWN";
int lightIntensity = 0;
String motionState = "UNKNOWN";
float temperature = 0.0;
float humidity = 0.0;

WiFiServer server(80);

unsigned long lastUpdate = 0;
const unsigned long interval = 20000;  // 20 seconds

// ====== SETUP ======
void setup() {
  Serial.begin(115200);
  delay(3000);

  pinMode(LIGHT_SENSOR_PIN, INPUT);
  pinMode(PIR_SENSOR_PIN, INPUT);
  dht.begin();

  Serial.println("Connecting to WiFi...");
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("\nConnected to WiFi!");
  Serial.println("IP Address: " + WiFi.localIP().toString());

  // Configure time from NTP
  configTime(0, 0, "pool.ntp.org", "time.nist.gov");
  Serial.print("Synchronizing time");
  while (!time(nullptr)) {
    Serial.print(".");
    delay(1000);
  }
  Serial.println("\nTime synchronized!");

  server.begin();
}

// ====== LOOP ======
void loop() {
  if (millis() - lastUpdate >= interval) {
    readSensors();
    sendToSerial();
    sendToFirebase();
    lastUpdate = millis();
  }
  handleWebClient();
}

// ====== SENSOR FUNCTIONS ======
int getAverageLight(int samples = 3) {
  long total = 0;
  for (int i = 0; i < samples; i++) {
    total += analogRead(LIGHT_SENSOR_PIN);
    delay(10);
  }
  return total / samples;
}

String getStableMotionState() {
  int motionCount = 0;
  for (int i = 0; i < 5; i++) {
    if (digitalRead(PIR_SENSOR_PIN) == LOW) {
      motionCount++;
    }
    delay(50);
  }
  return (motionCount >= 3) ? "DETECTED" : "NOT DETECTED";
}

bool readDHT() {
  int attempts = 0;
  temperature = dht.readTemperature();
  humidity = dht.readHumidity();

  while ((isnan(temperature) || isnan(humidity)) && attempts < 5) {
    delay(2000);
    temperature = dht.readTemperature();
    humidity = dht.readHumidity();
    attempts++;
  }
  return !(isnan(temperature) || isnan(humidity));
}

void readSensors() {
  lightIntensity = getAverageLight();
  lightState = (lightIntensity < 2000) ? "ACTIVE" : "INACTIVE";
  motionState = getStableMotionState();

  if (!readDHT()) {
    Serial.println("DHT read failed. Using fallback values.");
    temperature = 0.0;
    humidity = 0.0;
  }
}

// ====== TIMESTAMP FUNCTION ======
String getTimeStamp() {
  time_t now = time(nullptr);
  struct tm* timeinfo = localtime(&now);

  char buffer[25];
  strftime(buffer, sizeof(buffer), "%Y-%m-%d %H:%M:%S", timeinfo);
  return String(buffer);
}

// ====== SERIAL OUTPUT ======
void sendToSerial() {
  Serial.println("=== SENSOR DATA ===");
  Serial.println("Timestamp: " + getTimeStamp());
  Serial.println("Light: " + lightState);
  Serial.println("Light Intensity: " + String(lightIntensity));
  Serial.println("Motion: " + motionState);
  Serial.printf("Temp: %.1f °C\n", temperature);
  Serial.printf("Humidity: %.1f %%\n", humidity);
  Serial.println("====================\n");
}

// ====== FIREBASE SENDER ======
void sendToFirebase() {
  if (WiFi.status() == WL_CONNECTED) {
    HTTPClient http;
    String timestamp = getTimeStamp();
    String firebasePath = "/sensorData/" + String(millis()) + ".json";
    String url = firebaseHost + firebasePath;

    http.begin(url);
    http.addHeader("Content-Type", "application/json");

    String jsonPayload = "{";
    jsonPayload += "\"timestamp\":\"" + timestamp + "\",";
    jsonPayload += "\"light\":\"" + lightState + "\",";
    jsonPayload += "\"lightIntensity\":" + String(lightIntensity) + ",";
    jsonPayload += "\"motion\":\"" + motionState + "\",";
    jsonPayload += "\"temperature\":" + String(temperature, 1) + ",";
    jsonPayload += "\"humidity\":" + String(humidity, 1);
    jsonPayload += "}";

    int httpResponseCode = http.PUT(jsonPayload);
    if (httpResponseCode > 0) {
      Serial.println("Firebase Response Code: " + String(httpResponseCode));
      Serial.println("Firebase Response: " + http.getString());
    } else {
      Serial.println("Error sending to Firebase: " + http.errorToString(httpResponseCode));
    }
    http.end();
  } else {
    Serial.println("WiFi Disconnected - Cannot send to Firebase");
  }
}

// ====== LOCAL HTML SERVER ======
void handleWebClient() {
  WiFiClient client = server.available();
  if (client) {
    Serial.println("New Client Connected.");
    String request = client.readStringUntil('\r');
    client.flush();

    String html = "<!DOCTYPE html><html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>";
    html += "<title>Hydroponics Sensor Data</title></head><body style='font-family:sans-serif; text-align:center'>";
    html += "<h2>Hydroponics Monitoring System</h2>";
    html += "<p><b>Light Sensor:</b> " + lightState + "</p>";
    html += "<p><b>Light Intensity:</b> " + String(lightIntensity) + "</p>";
    html += "<p><b>Motion Sensor:</b> " + motionState + "</p>";
    html += "<p><b>Temperature:</b> " + String(temperature, 1) + " °C</p>";
    html += "<p><b>Humidity:</b> " + String(humidity, 1) + " %</p>";
    html += "<p><b>Timestamp:</b> " + getTimeStamp() + "</p>";
    html += "<hr><p><i>Refresh the page to update data</i></p>";
    html += "</body></html>";

    client.println("HTTP/1.1 200 OK");
    client.println("Content-type:text/html\r\n");
    client.println(html);
    delay(1);
    client.stop();
    Serial.println("Client Disconnected.");
  }
} 
